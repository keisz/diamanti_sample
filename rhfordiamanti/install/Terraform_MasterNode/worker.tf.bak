resource "vsphere_virtual_machine" "rhcos_worker" {
  count            = lookup(var.env, "vm_count")
  name             = "ks-k8s-ocp-w-${count.index}"
  resource_pool_id = data.vsphere_resource_pool.pool.id
  datastore_id     = data.vsphere_datastore.datastore.id
  host_system_id   = data.vsphere_host.host241.id
  wait_for_guest_net_routable = false
  wait_for_guest_ip_timeout = 1
  

  num_cpus = lookup(var.env, "num_cpus")
  memory   = lookup(var.env, "memory")
  guest_id = lookup(var.env, "guest_id")

  network_interface {
    network_id     = data.vsphere_network.network_2.id
    use_static_mac = true
    mac_address    = "00:50:56:00:00:${13+count.index}"
  }

  disk {
    label            = "disk0"
    size             = lookup(var.env, "disk_worker")
    thin_provisioned = true
  }

  cdrom {
    datastore_id = data.vsphere_datastore.iso_datastore.id
    path         = var.iso_image
  }

}

#resource "vsphere_compute_cluster_vm_group" "cluster_vm_group_k8s" {
#  name                = "ks-k8s"
#  compute_cluster_id  = data.vsphere_compute_cluster.compute_cluster.id
#  virtual_machine_ids = vsphere_virtual_machine.vm_ubuntu.*.id
#}
